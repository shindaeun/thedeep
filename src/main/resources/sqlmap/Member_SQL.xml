<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//iBATIS.com//DTD SQL Map 2.0//EN" "http://www.ibatis.com/dtd/sql-map-2.dtd">

<sqlMap namespace="MemberSpace">

	<typeAlias alias="egovMap"
		type="egovframework.rte.psl.dataaccess.util.EgovMap" />
	<update id="memberDAO.updateCart">
	<![CDATA[
	update cart set amount=#amount# where userid=#userid# and cscode=#cscode#
	]]>
	</update>
	<delete id="memberDAO.cartDelete">
		delete from cart where userid=#userid# and
		cscode=#cscode#
	</delete>

	<select id="memberDAO.selectPointList" resultClass="egovMap">
	 <![CDATA[
	 select l.ocode,to_char(odate,'yyyy-mm-dd') odate,pname,'-'||usepoint point from orderList l, orderMain m,product p where l.ocode=m.ocode and l.cscode=p.cscode and userid=#userid#
	union
	select l.ocode,to_char(odate,'yyyy-mm-dd') odate,pname,'+'||savepoint point from orderList l, orderMain m,product p where l.ocode=m.ocode and l.cscode=p.cscode and userid=#userid#
	order by ocode desc
	 ]]>
	</select>
	<select id="memberDAO.selectAllPoint" resultClass="java.lang.String">
	 <![CDATA[
	 select sum(savepoint) from orderList l,ordermain m where l.ocode=m.ocode and userid=#userid#
	 ]]>
	</select>
	<select id="memberDAO.selectAblePoint" resultClass="java.lang.String">
	 <![CDATA[
		select ablepoint from memberinfo where userid=#userid#
	 ]]>
	</select>

	<select id="memberDAO.selectUserReview" resultClass="egovMap">
		select b.*
		from(
		select
		rownum rn,a.*
		from(
		SELECT
		unq unq,
		title title,
		hit
		hit,
		to_char(rdate,'yyyy-mm-dd') rdate
		FROM
		review
		WHERE
		userid=#userid#
		<isNotNull property="searchKeyword">
			<isNotEmpty property="searchKeyword">
				AND $searchCondition$ LIKE '%' ||
				#searchKeyword# || '%'
			</isNotEmpty>
		</isNotNull>
		ORDER BY
		unq DESC
		) a
		) b
		where
		rn > $firstIndex$ and rn  <![CDATA[<=]]>
		$lastIndex$
	</select>
	
	<select id="memberDAO.selectUserReviewTotCnt" resultClass="java.lang.Integer">
	SELECT
		count(unq)
		FROM
		review
		WHERE
		userid=#userid#
		<isNotNull property="searchKeyword">
			<isNotEmpty property="searchKeyword">
				AND $searchCondition$ LIKE '%' || #searchKeyword# || '%'
			</isNotEmpty>
		</isNotNull>
		ORDER BY
		unq DESC
	</select>
	<select id="memberDAO.selectUserQna" resultClass="egovMap">
		select b.*
		from(
		select
		rownum rn,a.*
		from(
		SELECT
		unq unq,
		title title,
		hit
		hit,
		to_char(rdate,'yyyy-mm-dd') rdate
		FROM
		qna
		WHERE
		userid=#userid#
		<isNotNull property="searchKeyword">
			<isNotEmpty property="searchKeyword">
				AND $searchCondition$ LIKE '%' ||
				#searchKeyword# || '%'
			</isNotEmpty>
		</isNotNull>
		ORDER BY
		unq DESC
		) a
		) b
		where
		rn > $firstIndex$ and rn  <![CDATA[<=]]>
		$lastIndex$
	</select>
	
	<select id="memberDAO.selectUserQnaTotCnt" resultClass="java.lang.Integer">
	SELECT
		count(unq)
		FROM
		qna
		WHERE
		userid=#userid#
		<isNotNull property="searchKeyword">
			<isNotEmpty property="searchKeyword">
				AND $searchCondition$ LIKE '%' || #searchKeyword# || '%'
			</isNotEmpty>
		</isNotNull>
		ORDER BY
		unq DESC
	</select>
	<select id="memberDAO.selectCouponList" resultClass="egovMap">
	 <![CDATA[
	select cname||' '||discountrate||'% 할인' coupon, applymoney||'원 이상 주문 시 사용가능' subject1, '최대 '||maxDiscmoney||'원 할인 가능' subject2,sdate||'~'||edate usedate
	from couponList l, coupon c 
	where c.CCODE = l.CCODE and userid=#userid# and sysdate<edate
	 ]]>
	</select>
	<select id="memberDAO.selectCartList" resultClass="egovMap">
	 <![CDATA[
	select userid,c.cscode,c.pcode,pname,price,amount,filename,substr(c.cscode,7,1) cssize,substr(c.cscode,8) cscolor,round(price*0.001) savepoint
	from cart c, product p
	where userid=#userid#
	and c.cscode=p.cscode
	 ]]>
	</select>

</sqlMap>
